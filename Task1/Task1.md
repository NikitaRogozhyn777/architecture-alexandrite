# Задание 1. Анализ, идентификация проблем и решений, планирование

# Список проблем:

## 1. Проблемы с производительностью и масштабируемостью

- Сервисы работают на одном инстансе и нет балансировки нагрузки, нет отказоустойчивости.
- Нет автоматического масштабирования (autoscaling) под нагрузку.
- Базы данных не реплицированы, нет read-replicas для разгрузки основного инстанса.
- Нет кэширования для часто запрашиваемых данных (например, списка заказов).
- API MES не справляется с нагрузкой после открытия для внешних продавцов.
- MES долго загружает список заказов (особенно первую страницу с дашбордом), несмотря на пагинацию и фильтрацию.
- Расчёт стоимости в MES занимает от 2-3 минут до 30 минут, что может создавать узкое горло при большом количестве заказов.

## 2. Проблемы с обработкой заказов и их статусами
- Нет чёткого трекинга заказов между CRM и MES, из-за чего заказы теряются или зависают.
- Нет автоматических уведомлений клиентов о статусе заказа.

## 3. Проблемы с процессами разработки и тестированием
- Нет мониторинга и алертинга, проблемы обнаруживаются только по жалобам.
- Ручное тестирование замедляет релизы, QA не успевает проверять всё вовремя.
- Нет автоматизированных E2E-тестов, из-за чего баги обнаруживаются поздно.
- Задержки релизов из-за high-багов могут достигать месяца.

## 4. Организационные и кадровые проблемы
- Не хватает специалистов по React (только один частично знает, хотя есть система, часть которой написана на React).
- Нет выделенного SRE/инженера по производительности.
- DevOps один на всю инфраструктуру, возможна перегрузка.


## Потенциальные риски, если не решить проблемы
- Потеря клиентов (уже ушли несколько крупных контрактов).
- Дальнейший рост нагрузки приведёт к полному отказу системы.
- Репутационные потери, так как клиенты жалуются на задержки.
- Увеличение нагрузки на поддержку (ручные проверки, исправления).
- Замедление развития бизнеса из-за технических ограничений.

# Инициативы, которые необходимы для устранения нежелательных ситуаций с поизводительностью и масштабируемостью

## 1. Требуется реализовать масштабирование инфраструктуры
- Выполнить переход на кластерную архитектуру (Перейти на Kubernetes или managed-сервисы для автоматического масштабирования).
- Настроить Репликация БД (настроить read-replicas для разгрузки основных инстансов баз данных).
- Настроить балансировка нагрузки (Nginx/ALB для распределения запросов между инстансами).

## 2. Выполнить Оптимизацию MES
- Введение кэширования для списка заказов (например, Redis) → уменьшит нагрузку на БД и ускорит загрузку дашборда.
- Оптимизация запросов к БД (индексы, денормализация, материализованные представления).
- Асинхронная обработка расчёта стоимости (вынести в фоновые задачи, чтобы не блокировать интерфейс).
- Выделение отдельных инстансов для API MES, чтобы внешние запросы не мешали внутренним процессам.

## 3. Реализовать резервное копирование и отказоустойчивость
- Автоматические бэкапы БД (ежедневные + перед релизами).
- Multi-AZ развёртывание (если облако позволяет).
- План аварийного восстановления (DRP) с возможностью быстрого переключения на backup-инстансы.

## 4. Добавить Мониторинг и алертинг
- Внедрение Prometheus + Grafana для отслеживания: времени ответа API, нагрузки на БД и очереди, количества заказов в разных статусах
- Настройка алертов при достижении критических значений (например, очередь RabbitMQ > 1000 сообщений).
- Внедрение трейссинга (Jaeger), для отслеживания цепочки вызовов и нахождения узких мест.

## 5. Внедрение паттерна Circuit Breaker
- Внедрение Circuit Breaker для критических интеграций (CRM↔MES)
- Внедрение Circuit Breaker при интеграциях MES API с внешними партнерами

После этих изменений система станет стабильнее, а клиенты перестанут жаловаться на задержки.

# Инициативы, которые необходимы для устранения нежелательных ситуаций с обработкой заказов и их статусами

## 1. Улучшить синхронизацию статусов между системами (CRM ↔ MES)
- Реализовать паттерн Transactional Outbox, для гарантирования, что изменение в CRM/MES и отправка события происходят атомарно.
- Реализация отдельного микросервиса (Order Status Service), для управления статусами, для централизованной проверки консистентности статусов,
  а также добавить возможность ручной коррекции через админку.
- Реализовать Dead Letter Queue (DLQ) для обработки сбоев.

## 2. Автоматизировать процесс уведомлений клиентов
- Добавить интеграцию с  Email/SMS-сервисами (SendGrid, Twilio). Необходимо реализовать уведомление при смене ключевых статусов (MANUFACTURING_STARTED, SHIPPED).
  Добавить возможность клиенту отслеживать заказ в личном кабинете.
- Будет плюсом настроить Чат-бот / Telegram-уведомления для партнёров и клиентов.

## 3. Выполнить работы по улучшению видимости заказов для операторов
- Реализовать real-time дашборд в MES (WebSockets + Server-Sent Events), для автообновление списка заказов без перезагрузки страницы.
- Добавить логирование всех изменений статусов (Audit Log) для разбора спорных ситуаций.

## 4. Выполнить оптимизацию бизнес-процессов
- Добавить чёткие SLA для каждого статуса (например, SUBMITTED → PRICE_CALCULATED ≤ 1 час).
- Настроить автоматическое эскалирование просроченных заказов (добавить уведомление менеджеров).
- Добавить введение "заморозки" заказов при долгом бездействии (например, если клиент не подтвердил цену).
- Добавить ежедневные автоматические проверки (Cron-задачи)
  Например: Заказы в статусе SUBMITTED, но без PRICE_CALCULATED > 24 ч. или заказы в MANUFACTURING_STARTED > 3 недель.
- Добавить ручной интерфейс для поиска "зависших" заказов (по ID, клиенту, дате).

В результате сократятся сроки выполнения заказов (меньше простоев), уменьшится число жалоб (клиенты в курсе статусов), а операторы повысят эффективность (чёткие приоритеты).

# Инициативы, которые необходимы для устранения нежелательных ситуаций с процессами разработки и тестированием

## 1. Реализовать автоматизацию тестирования
- Внедрить E2E-тесты (Playwright, Cypress) для критических сценариев, например: создание заказа → расчёт стоимости → подтверждение → производство
- Выполнить покрытие API-тестами (например с помощью Postman) для всех ключевых endpoints.
- Добавить интеграционные тесты для сложной логики (например, расчёта стоимости).
- Добавить тесты производительности (JMeter) для API MES и CRM.

## 2. Выполнить улучшение CI/CD-процессов
- Реализовать автоматический деплой в release/prod после успешных тестов (GitHub Actions, GitLab CI).
- Реализовать Canary-развёртывание (постепенный rollout для минимизации рисков).
- Добавить Feature Flags для безопасного включения новых функций.
- Настроить автоматический откат при обнаружении critical-багов в prod.

## 3. Оптимизировать ручное тестирование
- Приоритезировать тест-кейсы, сначала критичные сценарии, потом остальные.
- Добавить чек-листы для QA, чтобы минимизировать человеческий фактор.

## 4. Настроить мониторинг и алертинг в CI/CD
- Настроить интеграция с Sentry для отслеживания ошибок после деплоя.
- Настроить алерты при падении тестов (Slack/Telegram-уведомления).
- Настроить Дашборд с метриками (количество багов, время прогона тестов).

## 5. Улучшить процессы код-ревью и обучение команды
- Установить мандат на 2 approve перед мерджем (особенно для критичных изменений).
- Добавить статические анализаторы кода (SonarQube, ESLint)
- Проводить воркшопы по всем ключевым решениям в разработке или процессам для команды.
- Вести и держать документацию (например в Confluence) в актуальном состоянии.

Это приведёт к сокращению сроков релизов (с месяца до 1-2 недель), снижению количества багов в prod и возможности масштабирования команды без потери качества.

# Инициативы, которые необходимы для устранения нежелательных ситуаций связанных с организационными и кадровыми проблемами

## 1. Выполнить оптимизацию команды разработки, а также перераспределение ролей и зон ответственности
- Нанять дополнительного React-разработчика (или обучить имеющегося Vue-инженера).
- Взять в команду SRE/Performance-инженера для оптимизации MES и инфраструктуры.
- Настроить чёткое разделение задач между Java/C# разработчиками (например, Java – CRM/магазин, C# – MES).
- Выделение отдельного DevOps/SRE под инфраструктуру (если текущий инженер перегружен).

## 2. Укрепить бизнес-коммуникации
- Проводить регулярные sync-митинги с продактом и менеджерами, чтобы разработка понимала приоритеты.
- Реализовать прозрачный roadmap для бизнеса (что в работе, какие сроки).
- Доносить обратную связь от клиентов → команде, чтобы разработчики понимали боли пользователей.

## 3. Проработать улучшения в процессе управления
- Устраивать регулярные ретроспективы (разбор проблем после каждого спринта).
- Подумать над внедрением гибкой система мотивации (премии за снижение инцидентов в prod).

В результате команда станет более сбалансированной и продуктивной, нагрузка на текущих сотрудников снизится, а бизнес начнёт получать более предсказуемые релизы.


## Приоритизация инициатив

| Приоритет | Категория                     | Название инициативы                          | Эффект                                                                 |
|-----------|-------------------------------|----------------------------------------------|------------------------------------------------------------------------|
| 🔴 High   | Производительность            | Внедрение Circuit Breaker | Защитит систему от каскадных сбоев при проблемах интеграций          |
| 🔴 High   | Производительность            | Введение кэширования (Redis)                 | Уменьшит нагрузку на БД и ускорит загрузку дашборда                   |
| 🔴 High   | Производительность            | Оптимизация запросов к БД (индексы)          | Улучшит скорость работы MES                                           |
| 🔴 High   | Производительность            | Переход на Kubernetes                        | Обеспечит автоматическое масштабирование и отказоустойчивость         |
| 🔴 High   | Производительность            | Репликация БД                                | Увеличит доступность данных и распределит нагрузку                    |
| 🔴 High   | Производительность            | Внедрение трейссинга (Jaeger/Zipkin)         | Позволит отслеживать цепочки вызовов и находить узкие места           |
| 🔴 High   | Обработка заказов             | Transactional Outbox для статусов             | Гарантирует атомарность изменений статусов                             |
| 🔴 High   | Обработка заказов             | Order Status Service                         | Централизованное управление статусами                                  |
| 🔴 High   | Организационные проблемы      | Нанять React-разработчика                    | Устранит узкое место в поддержке MES                                   |
| 🟠 Medium | Обработка заказов             | Автоматические уведомления                   | Уменьшит количество жалоб клиентов                                    |
| 🟠 Medium | Обработка заказов             | Real-time дашборд                            | Улучшит видимость заказов для операторов                               |
| 🟠 Medium | Процессы разработки           | E2E-тесты                                    | Снизит количество багов в prod                                        |
| 🟠 Medium | Организационные проблемы      | Нанять SRE-инженера                          | Улучшит надежность инфраструктуры                                     |
| 🟢 Low    | Производительность            | Мониторинг (Prometheus)                      | Позволит оперативно выявлять проблемы                                 |
| 🟢 Low    | Обработка заказов             | Audit Log                                    | Обеспечит прозрачность изменений статусов                             |
| 🟢 Low    | Процессы разработки           | Автоматический деплой                        | Ускорит процесс выпуска обновлений                                    |
| 🟢 Low    | Организационные проблемы      | Четкое разделение задач                      | Улучшит эффективность команды                                         |

## Обоснование приоритетов
Среди всех запланированных улучшений можно выделить три ключевые категории, распределённые по степени срочности и важности:

🔴 Критические инициативы (требуют немедленного внимания)
В первую очередь необходимо сосредоточиться на оптимизации производительности MES-системы за счёт внедрения кэширования и пересмотра индексов, а также масштабированием инфраструктуры, чтобы система могла справляться с растущей нагрузкой. Параллельно важно обеспечить надёжную синхронизацию статусов, чтобы избежать расхождений в данных. Также в приоритете — устранение кадровых узких мест, которые сейчас тормозят ключевые процессы.

🟠 Важные инициативы (требуют реализации в среднесрочной перспективе)
На следующем этапе предстоит заняться повышением видимости заказов — это позволит сократить количество ошибок и ускорить обработку. Кроме того, необходимо внедрить базовое автоматизированное тестирование, чтобы повысить стабильность ключевых функций.

🟢 Долгосрочные инициативы (стратегические улучшения)
В перспективе стоит реализовать комплексный мониторинг для оперативного выявления проблем, а также постепенную автоматизацию рутинных процессов. Организационные улучшения, такие как оптимизация внутренних процедур, тоже важны, но могут быть реализованы по мере решения более насущных задач.
